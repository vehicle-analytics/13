# Логіка розрахунку стану авто

## Загальний опис

Стан авто (Health Score) розраховується на основі кількох критеріїв і виражається у відсотках від 0 до 100. Початкове значення - **100%**.

## Алгоритм розрахунку

### 1. Початкове значення
- **Початковий бал: 100%**

### 2. Аналіз стану запчастин

Для кожної запчастини в автомобілі:

#### Критичний стан (`critical`)
- **Віднімається: -4%** за кожну критичну деталь
- Деталь додається до списку `criticalParts`

#### Стан "Увага" (`warning`)
- **Віднімається: -2%** за кожну деталь зі статусом "Увага"
- Деталь додається до списку `warningParts`

**Приклад:**
- Якщо у авто 2 критичні деталі та 3 деталі зі статусом "Увага":
  - Віднімається: 2 × (-4%) + 3 × (-2%) = -8% - 6% = **-14%**

### 3. Врахування віку авто

Вік авто = поточний рік - рік випуску авто

| Вік авто | Віднімається |
|---------|--------------|
| Старше 18 років | **-25%** |
| Старше 10 років (але ≤ 18) | **-10%** |
| Старше 5 років (але ≤ 10) | **-5%** |
| 5 років або менше | **0%** (не віднімається) |

**Приклад:**
- Авто 2010 року випуску (2024 - 2010 = 14 років):
  - Віднімається: **-10%**

### 4. Врахування пробігу

| Пробіг | Віднімається |
|--------|--------------|
| Понад 500,000 км | **-10%** |
| Понад 300,000 км (але ≤ 500,000) | **-5%** |
| Понад 200,000 км (але ≤ 300,000) | **-3%** |
| 200,000 км або менше | **0%** (не віднімається) |

**Приклад:**
- Авто з пробігом 350,000 км:
  - Віднімається: **-5%**

### 5. Врахування оцінки з фото (лист "Оцінка авто фото", стовпець H)

Оцінка стану авто з фото впливає на фінальний бал:

| Стан з фото | Модифікатор |
|------------|-------------|
| **Відмінний** | **+10%** |
| **Добрий** | **+3%** |
| **Задовільний** | **-5%** |
| **Критичний** | **-26%** |

**Приклад:**
- Якщо стан з фото "Добрий":
  - Додається: **+3%**

### 6. Фінальне обмеження

Після всіх розрахунків:
- **Мінімальне значення: 0%** (не може бути менше)
- **Максимальне значення: 100%** (не може бути більше)
- Значення округлюється до цілого числа

## Приклад повного розрахунку

**Умови:**
- Авто: 2010 рік випуску
- Пробіг: 350,000 км
- Критичні деталі: 2 (ГРМ, Помпа)
- Деталі "Увага": 3 (ТО, Гальмівні диски передні, Амортизатори)
- Оцінка з фото: "Добрий"

**Розрахунок:**
1. Початковий бал: **100%**
2. Критичні деталі: 2 × (-4%) = **-8%**
3. Деталі "Увага": 3 × (-2%) = **-6%**
4. Вік авто (14 років): **-10%**
5. Пробіг (350,000 км): **-5%**
6. Оцінка з фото ("Добрий"): **+3%**

**Фінальний бал:**
100 - 8 - 6 - 10 - 5 + 3 = **74%**

## Категорії стану авто

Після розрахунку бал перетворюється на категорію:

| Бал | Категорія | Колір |
|-----|-----------|-------|
| **≥ 86%** | **Відмінний** | Зелений (green-400 to green-500) |
| **61% - 85%** | **Добрий** | Синій (blue-400 to blue-500) |
| **41% - 60%** | **Задовільний** | Жовтий (yellow-400 to yellow-500) |
| **35% - 40%** | **Поганий** | Помаранчевий (orange-400 to orange-500) |
| **< 35%** | **Критичний** | Червоний (red-400 to red-500) |

## Важливі примітки

1. **Кожна критична деталь** впливає на загальний стан авто, тому важливо своєчасно обслуговувати критичні запчастини.

2. **Вік авто** має значний вплив на стан, особливо для авто старше 10 років.

3. **Високий пробіг** також знижує загальний стан авто.

4. **Оцінка з фото** може як покращити, так і погіршити стан, залежно від реального стану авто.

5. **Мінімальний бал 0%** гарантує, що стан не буде від'ємним, навіть якщо сума всіх віднімань перевищить 100%.

## Функції в коді

- `calculateHealthScore(car)` - основна функція розрахунку стану
- `getHealthScoreLabel(score)` - отримання текстової категорії стану
- `getHealthScoreColor(score)` - отримання кольору для візуалізації
- `getHealthScoreStatus(score)` - отримання статусу (використовується для відображення)

## Джерела даних

1. **Стан запчастин** - з обробки історії обслуговування (лист "Ответы на форму (1)")
2. **Вік авто** - з листа "ГРАФІК ОБСЛУГОВУВАННЯ" (стовпець рік випуску)
3. **Пробіг** - поточний пробіг з історії обслуговування
4. **Оцінка з фото** - з листа "Оцінка авто фото" (стовпець H "Стан")
